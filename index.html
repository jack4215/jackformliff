<!doctype html>
<html class="no-js" lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title></title>
  <meta name="description" content="">
  <meta name="keywords" content="">
  <meta name="robots" content="noindex, nofollow">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta property="og:title" content="">
  <meta property="og:description" content="">
  <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
  <script>
    window.onload = function () {
      var path = new URL(window.location);
      var liffId = path.searchParams.get('liff_id');
      var formUrl = path.searchParams.get('form');
      var redirect = function(id) {
        var src = decodeURIComponent(formUrl.replace('*%7CUID%7C*', id));
        //var src = decodeURIComponent(formUrl.replace('*%7CNAME%7C*', Name));
        try {
          window.location.replace(src);
        } catch {
          window.location.href = src;
        }
      };
      
      if (!path.searchParams.has('form')) {
        alert('請使用 LINE 應用程式開啟');
        return;
      }
      if (!path.searchParams.has('liff_id')) {
        alert('僅限開啟 Google 表單，請重新確認網址');
        return;
      }
      
      liff.init({
        liffId: liffId
      }).then(function (e) {
        var isLoggedIn = liff.isLoggedIn();
        var context = liff.getContext();

        if (context !== null && context.userId) {
          redirect(context.displayName);
          redirect(context.userId);
          return;
        }

        if (isLoggedIn) {
          liff.getProfile()
            .then(function(data) {
              redirect(data.displayName);
              redirect(data.userId);
            })
            .catch(function(err) {
              alert(err);
            })
        } else {
          liff.login({
            redirectUri: location.href
          })
        }
      }).catch(function (e) {
        alert(e);
      })
    }
  </script>
</head>

<body>
</body>

</html>
